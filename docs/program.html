<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <title>Theory - StoRM-CFD</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ]
        });"></script>
    <style>
                .flowchart-wrapper {
                    display: flex;
                    justify-content: center; /* This centers your flowchart */
                }
                .flowchart-wrapper .mermaid {
                    min-width: 600px;  /* Adjust this value as needed */
                    max-width: 100%; /* Allows it to be responsive */
                }
                /* Make Mermaid-rendered SVGs fill the mermaid container */
                .mermaid svg {
                    width: 100% !important;
                    height: 100% !important;
                    max-width: none !important;
                    display: block;
                    margin-left: auto;
                    margin-right: auto;
                }

                /* Trial dimensions: adjust these values (height / max-width) as needed */
                .mermaid {
                    width: 100%;            /* use most of the page width */
                    max-width: 1800px;    /* cap width to avoid overly wide diagrams */
                    height: 50vh;         /* try 60vh, 70vh, 80vh or px values like 700px */
                    margin: 0 auto 2rem auto;
                    overflow: visible;    /* allow svg to be visible if larger */
                }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600&display=swap" rel="stylesheet">
    
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header Navigation -->
    <header class="shadow-md sticky top-0 z-40">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <!-- Project Title -->
            <a href="index.html" class="text-2xl font-bold text-white">StoRM-CFD</a>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden text-gray-700 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>

            <!-- Desktop Navigation Links -->
            <div class="hidden md:flex items-center space-x-6">
                <div class="relative group">
                    <a href="index.html" class="text-white transition-colors font-bold">
                        Home
                        <svg class="w-4 h-4 inline-block ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    
                    <div class="absolute -left-4 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden group-hover:block">
                        <a href="index.html#about" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">About StoRM-CFD</a>
                        <a href="index.html#install" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Quick Installation</a>
                        <a href="index.html#contact" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Contact</a>
                        <a href="index.html#citation" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Citation</a>
                    </div>
                </div>
            
                <div class="relative group">
                    <a href="equations.html" class="text-white transition-colors font-bold">
                        Theory
                        <svg class="w-4 h-4 inline-block ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    <div class="absolute -left-4 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden group-hover:block">
                        <a href="equations.html#governing-equations" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Equations</a>
                        <a href="equations.html#closure-models" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Closure Models</a>
                        <a href="equations.html#solution-algo" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Solution Algorithm</a>
                    </div>
                </div>
            
                <div class="relative group">
                    <button class="text-white bg-blue-600 px-3 py-2 rounded-md text-sm font-bold" aria-current="page">
                        Program
                        <svg class="w-4 h-4 inline-block ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="absolute -left-4 w-48 bg-white rounded-md shadow-lg py-1 z-50 hidden group-hover:block">
                        <a href="#libraries" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Libraries</a>
                        <a href="#solver" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">CFD Solver</a>
                        <a href="#boundary-condition" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Boundary Conditions</a>
                        <a href="#utilities" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Utilities</a>
                    </div>
                </div>
                
                <div class="relative group">
                    <a href="tutorials.html" class="text-white transition-colors font-bold">
                        Tutorials
                        <svg class="w-4 h-4 inline-block ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                </div>
                <a href="html/index.html" class="text-white hover:text-red-500 transition-colors" target="_blank">API Documentation</a>
            </div>
        </nav>

        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden px-2 pt-2 pb-3 space-y-1">
            <a href="index.html" class="block px-3 py-2 rounded-md text-base font-bold text-white hover:bg-blue-700">Home</a>
            <a href="equations.html" class="block px-3 py-2 rounded-md text-base font-bold text-white bg-blue-600" aria-current="page">Theory</a>
            <a href="program.html" class="block px-3 py-2 rounded-md text-base font-bold text-white hover:bg-blue-700">Program</a>
            <a href="tutorials.html" class="block px-3 py-2 rounded-md text-base font-bold text-white hover:bg-blue-700">Tutorials</a>
            <a href="html/index.html" class="block px-3 py-2 rounded-md text-base font-bold text-white hover:bg-blue-700" target="_blank">API Documentation</a>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <section id="libraries" class="bg-white">
            <div class="container mx-auto px-6">
                <div class="max-w-7xl mx-auto">
                    <p class="text-2xl font-bold text-gray-900 mb-4">Libraries and Solver</p>
                    <p class="text-lg text-gray-700 leading-relaxed mb-4">The main application is <strong>rocketMotor</strong>
                        which depends on several libraries including the base libraries of OpenFOAM-v2112. The solver is developed
                        based on the native OpenFOAM v2112 solver "reactingMultiphaseEulerFoam". This framework has an additional
                        library that includes the relavant closure models for propellant surface regression and interphase 
                        interactions (drag and heat transfer models). 
                    </p>
                </div>
            </div>
            <div class="mermaid">
                %%{ init: { 
                    'theme': 'neutral', 
                    'fontFamily': 'Exo 2', 
                    'flowchart': { 'curve': 'stepAfter' }, 
                    'themeVariables': { 
                      'primaryColor': '#ffffff',
                      'edgeLabelBackground': '#ffffff', 
                      'tertiaryColor': '#ffffff', 
                      'lineColor': '#000000'
                    } 
                  } }%%
                flowchart LR
                subgraph OpenFOAM_Base_Group [<strong>OpenFOAM v2112 Base Libraries</strong>]
                    List["libfiniteVolume.so <br/> libOpenFOAM.so <br/> libfluidThermophysicalModels.so <br/> libreactionThermophysicalModels.so <br/> libcompressibleTransportModels.so <br/> libspecie.so <br/> libcompressibleTurbulenceModels.so <br/> libturbulenceModels.so <br/> libthermophysicalProperties.so <br/> libcombustionModels.so <br/> libmeshTools.so <br/> libsurfMesh.so <br/> libdynamicMesh.so"]
                    style List text-align:left
                end

                subgraph OpenFOAM_Multiphase_Group [<strong>OpenFOAM v2112 Multiphase Library</strong>]
                    B["libreactingMultiphaseSystem.so"]
                end
                
                subgraph Software_Group [<strong>StoRM-CFD Framework</strong>]
                    C["<strong>source library</strong> <br/> (libpropellantRegressionPhaseSystem.so)"]
                    D["<div style='padding: 10px 50px'><span style='font-size:30px; font-weight:bold'>rocketMotor</span> <br/> (Main Application)</div>"]
                end

                List -->|Mesh, Thermophysical and <br/> Transport properties| C
                B -->|Phase Models, Phase System <br/> and Phase Pair| C
                C -->|Multiphase Systems <br/> Interphase Models| D

                %% Subgraphs (Outer Boxes)
                style OpenFOAM_Base_Group fill:#fff8e1,stroke:#ffa000,stroke-width:2px;
                style OpenFOAM_Multiphase_Group fill:#fff8e1,stroke:#ffa000,stroke-width:2px;
                
                        
                %% Nodes (Inner Boxes)
                style List fill:#ffe0b2,stroke:#ffa000,stroke-width:1px;
                style B fill:#ffe0b2,stroke:#ffa000,stroke-width:1px;
                style C fill:#eceff1,stroke:#78909c,stroke-width:2px;
                style D fill:#c5e1a5,stroke:#7cb342,stroke-width:4px;
                        
                %% Link Styling 
                linkStyle 0,1,2 stroke:#000000,stroke-width:2px,fill:none,color:#000000
            </div>
        </section>

        <section id="solver" class="cn-wrapper">
            <div class="container mx-auto px-6">
                <div class="max-w-7xl mx-auto">
                    <p class="text-2xl font-bold text-white mb-4">ðŸš€ CFD solver - rocketMotor</p>
                </div>
            </div>
            <div class="cn-container">
                <div class="cn-sticky-col">
                    <div class="cn-code-window">
                        <div class="cn-window-header">
                            <span class="cn-dot red"></span>
                            <span class="cn-dot yellow"></span>
                            <span class="cn-dot green"></span>
                            <span class="cn-filename">rocketMotor/rocketMotor.C (PIMPLE Loop)</span>
                        </div>
                        <pre>
        <span class="cn-line" style="opacity: 0.3">// ... previous code ... (For one time step)</span>
        
        <span class="cn-line" id="L1"><span class="kwd">while</span> (pimple.<span class="fun">loop</span>())</span>
        <span class="cn-line" id="L2">{</span>
        <span class="cn-line" id="L3">    fluid.<span class="fun">solve</span>();</span>
        <span class="cn-line" id="L4">    fluid.<span class="fun">correct</span>();</span>
        <span class="cn-line" id="L5"></span>
        <span class="cn-line" id="L6">    <span class="com">// Find propellant cells to restrict velocity</span></span>
        <span class="cn-line" id="L7">    <span class="kwd">#include</span> <span class="str">"propellantCells.H"</span></span>
        <span class="cn-line" id="L8"></span>
        <span class="cn-line" id="L9">    <span class="com">// Find particle free cells to restrict Temp</span></span>
        <span class="cn-line" id="L10">    <span class="kwd">#include</span> <span class="str">"particleFreeCells.H"</span></span>
        <span class="cn-line" id="L11"></span>
        <span class="cn-line" id="L12">    <span class="com">// Solve Conservation Equations</span></span>
        <span class="cn-line" id="L13">    <span class="kwd">#include</span> <span class="str">"pU/UEqns.H"</span></span>
        <span class="cn-line" id="L14">    <span class="kwd">#include</span> <span class="str">"EEqns.H"</span></span>
        <span class="cn-line" id="L15">    <span class="kwd">#include</span> <span class="str">"pU/pEqn.H"</span></span>
        <span class="cn-line" id="L16"></span>
        <span class="cn-line" id="L17">    fluid.<span class="fun">correctKinematics</span>();</span>
        <span class="cn-line" id="L18">    fluid.<span class="fun">correctTurbulence</span>();</span>
        <span class="cn-line" id="L19">}</span>
        
        <span class="cn-line" style="opacity: 0.3">// ... remaining code ...</span>
                        </pre>
                    </div>
                </div>
        
                <div class="cn-scroll-col">
                    
                    <div class="cn-step" data-lines="L1">
                        <h3>Outer PIMPLE Loop</h3>
                        <p>We enter the main iterative loop for the current time step.</p>
                    </div>
        
                    <div class="cn-step" data-lines="L3">
                        <h3>Solve volume fraction equations for propellant, gas and particle phases</h3>
                        <!-- <p>At the start of every iteration, volume fraction equations are solved by calling <code>solve()</code> method 
                            that is present in the multiPhaseSystem object (<code>fluid</code>). This first invokes the <code>solve()</code>
                            function present in the <code>PropellantCombustionPhaseSystem.C</code> / <code>PropellantRegressionPhaseSystem.C</code> where the 
                            propellant mass burning rate is computed and the propellant surface is regressed as per the selected
                            <code>interfaceTrackingModel</code>. The next step is to solve volume fractions of gas and particle phase based on 
                            the MULES algorithm which is based on native OpenFOAM-v2112 implementation in <code>MultiPhaseSystem.C</code>
                        </p> -->
                        <p>
                            At the start of every iteration, volume fraction equations are solved by calling the <code>solve()</code> method on the 
                            <code>multiPhaseSystem</code> object (<code>fluid</code>). This triggers a specific sequence:
                        </p>
                        
                        <ol style="padding-left: 20px; color: #8b949e; line-height: 1.6;">
                            <li style="margin-bottom: 15px;">
                                <strong style="color: #c9d1d9;">Propellant Regression:</strong><br>
                                First, it invokes the <code>solve()</code> function in <code>PropellantCombustionPhaseSystem.C</code> 
                                (or <code>RegressionPhaseSystem</code>). Here, the <b>mass burning rate</b> is computed, and the propellant 
                                surface is regressed according to the selected <code>interfaceTrackingModel</code>.
                            </li>
                            
                            <li>
                                <strong style="color: #c9d1d9;">Gas & Particle Phases:</strong><br>
                                Next, it solves the volume fractions for the remaining phases. This utilizes the <b>MULES algorithm</b> 
                                based on the native OpenFOAM-v2112 implementation found in <code>MultiPhaseSystem.C</code>.
                            </li>
                        </ol>
                    </div>

                    <div class="cn-step" data-lines="L4">
                        <h3>Compute Mass Fluxes</h3>
                        <p>
                            The <code>correct()</code> method in <code>phaseSystem.C</code> <b>computes the mass fluxes</b> for all phases. This update is based on two key inputs:
                        </p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: #8b949e;">
                            <li>The <b>new volume fraction</b> fields (calculated in the previous step).</li>
                            <li>The <b>velocity field</b> from the previous iteration.</li>
                        </ul>
                    </div>
        
                    <div class="cn-step" data-lines="L6,L7,L9,L10">
                        <h3>Stability & Robustness</h3>
                        <p>
                            Unique to the <code>rocketMotor</code> solver, we apply explicit constraints to avoid non-physical 
                            values in the shared fluid domain:
                        </p>
                        <ul style="margin: 15px 0; padding-left: 20px; color: #8b949e; line-height: 1.6;">
                            <li style="margin-bottom: 15px;">
                                <strong style="color: #c9d1d9;">Propellant Cells:</strong><br>
                                In cells containing only solid propellant, gas and particle velocities are <b>fixed to zero</b>. 
                                This enforces the boundary condition at the regressing surface and prevents non-physical flows inside the solid.
                            </li>
                            <li>
                                <strong style="color: #c9d1d9;">Particle-Free Regions:</strong><br>
                                Where the particle fraction is negligible ($\alpha_p < 10^{-10}$), the particle temperature is 
                                forced to match the gas temperature ($T_p = T_g$). This prevents numerical divergence when heat 
                                transfer coefficients become artificially large in cells with no particles.
                            </li>
                        </ul>
                    </div>
        
                    <div class="cn-step" data-lines="L13">
                        <h3>Constructs Discretized Momentum Equation for gas and particle phase</h3>
                        <p>
                            The base momentum equation (excluding the pressure gradient) is constructed by calling the <code>UEqn()</code> method in the native OpenFOAM-v2112 <code>movingPhaseModel.C</code>.
                        </p>
                        <p>
                            However, inside <code>UEqn.H</code>, we extend this by calling <code>momentumTransfer()</code> to inject specific source terms sequentially:
                        </p>
                        <ul style="margin: 10px 0; padding-left: 20px; color: #8b949e; line-height: 1.6;">
                            <li style="margin-bottom: 10px;">
                                <b>Regression Source:</b> Added via <code>PropellantRegressionPhaseSystem.C</code> to account for momentum changes due to surface regression.
                            </li>
                            <li>
                                <b>Explicit Drag:</b> Added via <code>MomentumEnergyTransferPhaseSystem.C</code> to include explicit interphase drag forces.
                            </li>
                        </ul>
                        <p style="font-size: 0.9em; opacity: 0.8; border-left: 2px solid #58a6ff; padding-left: 10px; margin-top: 15px;">
                            Note: The <b>implicit</b> drag force terms are not added here; they are reserved for the pressure equation (<code>pEqn.H</code>) in the next section.
                        </p>
                    </div>

                    <div class="cn-step" data-lines="L14">
                        <h3>Energy Correction Loop</h3>
                        <!-- <p>Solves energy equation for gas and particle phase. 
                            The energy equation for the gas phase and particle phase is constructed in <code>EEqn()</code> method of 
                            their respective phase models. For <code>pureThermalEnergyPhaseModel</code> (recommended for gas
                            phase), the <code>EEqn()</code> method is implemented in <code>ThermalEnergyPhaseModel.C</code>. 
                            Similarly, for the particle phase the recommended phase model is pureParticlePhaseModel and the energy 
                            equation is implemented in <code>AnisothermalParticlePhaseModel.C</code>. 
                            These implementations does not include interphase interations. The interphase interations are added to the 
                            equations separately in EEqn.H present in the solver by calling the heatTransfer() method from the 
                            InterphaseHeatTransferPhaseSystem.C. After solving, enthalpy is converted to temperature using the Newton-Raphson method, 
                            and transport properties are updated. This cycle repeats <code>nEnergyCorrector</code> times which is set in the 
                            fvSolution of the case file.    
                        </p> -->
                            <p>
                                The energy equations are constructed via the <code>EEqn()</code> method in the respective phase models:
                            </p>
                            <ul style="margin: 10px 0; padding-left: 20px; color: #8b949e;">
                                <li><b>Gas:</b> <code>ThermalEnergyPhaseModel.C</code></li>
                                <li><b>Particles:</b> <code>AnisothermalParticlePhaseModel.C</code></li>
                            </ul>
                            <p>
                                Interphase interactions are added separately via <code>InterphaseHeatTransferPhaseSystem.C</code>. 
                                Finally, enthalpy is converted to Temperature using a <b>Newton-Raphson</b> iterator, repeating <code>nEnergyCorrector</code> times.
                            </p>
                    </div>

                    <div class="cn-step" data-lines="L15">
                        <h3>Pressure-Velocity Coupling</h3>
                        <ul style="margin: 10px 0; padding-left: 20px; color: #8b949e; line-height: 1.6;">
                            
                            <li style="margin-bottom: 15px;">
                                <strong style="color: #c9d1d9;">Predict Velocity:</strong><br>
                                Using the discretized momentum equation matrix, the <b>explicit drag force</b> terms are 
                                included by calling <code>phiKdPhis()</code> and <code>KdUByAs()</code> in 
                                <code>MomentumEnergyTransferPhaseSystem.C</code>. These predict the velocities and fluxes for both gas and particle phase, which 
                                are summed to obtain the total predicted flux.
                            </li>
                    
                            <li style="margin-bottom: 15px;">
                                <strong style="color: #c9d1d9;">Pressure Poisson Equation:</strong><br>
                                The equation for the common pressure $P$ is constructed based on the total predicted flux and the 
                                compressibility terms of the gas and particle phases.
                                <br>
                                <a href="#" style="display: inline-block; margin-top: 8px; font-size: 0.85em; color: #58a6ff; text-decoration: none; border: 1px solid rgba(88,166,255,0.3); padding: 4px 12px; border-radius: 20px;">
                                    ðŸ“„ Check Detailed Derivation
                                </a>
                            </li>
                    
                            <li>
                                <strong style="color: #c9d1d9;">Correct Velocity:</strong><br>
                                Finally, corrections are applied to the predicted velocity and flux fields. 
                                In addition, the <b>density is updated</b> here. This process repeats for <code>nCorrectors</code> 
                                loops (as set in <code>fvSolution</code>).
                            </li>
                        </ul>
                    </div>
        
                    <div class="cn-step" data-lines="L17,L18">
                        <h3>Turbulence Correction</h3>
                        <p>
                            Once the mean flow fields ($\alpha_k, \boldsymbol{u}_k, P, T_k$) are updated, the turbulence closure models are updated.
                        </p>
                    
                        <ul style="margin: 10px 0; padding-left: 20px; color: #8b949e; line-height: 1.6;">
                            
                            <li style="margin-bottom: 15px;">
                                <strong style="color: #c9d1d9;">Gas Phase Turbulence:</strong><br>
                                The turbulence models are corrected to update the eddy viscosity ($\nu_t$) and Reynolds stresses.
                            </li>
                    
                            <li>
                                <strong style="color: #c9d1d9;">Kinetic Theory of Granular Flow:</strong><br>
                                Simultaneously, the <b>granular temperature</b> ($\Theta$) is solved for the particle phase. 
                                This updates the particle pressure, shear stress, and collisional viscosities based on selected KTGF models.
                            </li>
                        </ul>
                    </div>
        
                    <div class="cn-spacer"></div>
                </div>
            </div>
        </section>

        <section id="boundary-condition" class="bg-white">
            <div class="container mx-auto px-6 py-8">
                <div class="max-w-7xl mx-auto">
                    <p class="text-2xl font-bold text-gray-900 mb-6">Boundary Conditions</p>
                    <p class="text-lg text-gray-700 leading-relaxed">
                        As this library is an extension of the <strong>OpenFOAM-v2112</strong> library, it fully supports all 
                        standard boundary conditions included in the base distribution. You can use standard conditions 
                        (e.g., <code>fixedValue</code>, <code>zeroGradient</code>) interchangeably with the specialized 
                        boundary conditions listed below.
                    </p>
        
                    <div class="bc-table-responsive">
                        <table class="bc-table">
                            <thead>
                                <tr>
                                    <th>Boundary Condition</th>
                                    <th>Description</th>
                                    <th>Compatible Fields</th>
                                    <th>Usage</th>
                                </tr>
                            </thead>
                            <tbody>    
                                <tr>
                                    <td class="bc-name">massLoadingFraction</td>
                                    <td class="bc-desc">
                                        Computes the particle phase volume fraction $\alpha_p$ at the inlet derived from a 
                                        specified mass loading ratio ($X_p$).
                                        $$
                                            \alpha_p = \left[1 + \left(\frac{1 - X_p}{X_p}\right)\left(\frac{\rho_g\boldsymbol{u}_g\cdot\boldsymbol{S}_f}{\rho_p\boldsymbol{u}_p\cdot\boldsymbol{S}_f}\right)\right]^{-1}
                                        $$
                                        where $\boldsymbol{S}_f$ is the patch area. 
                                    </td>
                                    <td class="bc-fields">
                                        $\alpha_p$ <br>
                                        <span style="font-size:0.9em; color:#666;">(volume fraction)</span>
                                    </td>
                                    <td class="bc-usage">
                                        <div class="foam-code-wrapper">
                                            <button class="bc-copy-btn" onclick="copyFoamCode(this)">Copy</button>
                                            <pre class="foam-code">
<span class="f-key">inlet</span>
{
    <span class="f-key">type</span>            <span class="f-val">massLoadingFraction</span>;
    <span class="f-key">name</span>            <span class="f-val">particles</span>; // name of the current phase
    <span class="f-key">gasPhase</span>        <span class="f-val">gas</span>; // name of the gas phase
    <span class="f-key">particlePhase</span>   <span class="f-val">particles</span>; // name of the particle phase
    <span class="f-key">massFraction</span>    <span class="f-val">0.81</span>; // particle phase mass fraction at the inlet
    <span class="f-key">value</span>           <span class="f-val">uniform 0</span>;
}</pre>
                                        </div>
                                    </td>
                                </tr>
        
                                <tr>
                                    <td class="bc-name">gasFlowRateInletVelocity</td>
                                    <td class="bc-desc">
                                        Computes the gas phase inlet velocity based on a specified mass flow rate ($\dot{m}_g$). 
                                        The flow rate can be defined as a constant value or a time-dependent function.
                                        $$
                                        \boldsymbol{u}_g = \frac{\dot{m}_g}{\alpha_g\rho_g|\boldsymbol{S}_f|}\cdot\hat{\boldsymbol{n}}_f
                                        $$
                                        where $\hat{\boldsymbol{n}}_f$ is the patch normal vector. 
                                    </td>
                                    <td class="bc-fields">
                                        $\boldsymbol{u}_g$ <br>
                                        <span style="font-size:0.9em; color:#666;">(vector)</span>
                                    </td>
                                    <td class="bc-usage">
                                        <div class="foam-code-wrapper">
                                            <button class="bc-copy-btn" onclick="copyFoamCode(this)">Copy</button>
                                            <pre class="foam-code">
<span class="f-key">inlet</span>
{
    <span class="f-key">type</span>           <span class="f-val">gasFlowRateInletVelocity</span>;
    <span class="f-key">massFlowRate</span>   <span class="f-val">constant 0.0001</span>; // flow rate function
    <span class="f-key">rho</span>            <span class="f-val">thermo:rho.gas</span>; // density of the gas phase
    <span class="f-key">value</span>          <span class="f-val">uniform (0 0 0)</span>;
}</pre>
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="bc-name">gasBurningRateInletVelocity</td>
                                    <td class="bc-desc">
                                        Calculates the gas phase inlet velocity based on the propellant mass burning rate which is 
                                        computed based on burning rate law $r_b[\text{cm/s}] = a(P[\text{MPa}])^n$, 
                                        where $P$ is the local pressure in the units of $\text{MPa}$. 
                                        $$
                                        \boldsymbol{u}_g = \frac{X_g\rho_{prop}r_b}{\alpha_g\rho_g}\cdot\hat{\boldsymbol{n}}_f
                                        $$
                                        where $\hat{\boldsymbol{n}}_f$ is the patch normal vector.
                                    </td>
                                    <td class="bc-fields">
                                        $\boldsymbol{u}_g$ <br>
                                        <span style="font-size:0.9em; color:#666;">(Vector)</span>
                                    </td>
                                    <td class="bc-usage">
                                        <div class="foam-code-wrapper">
                                            <button class="bc-copy-btn" onclick="copyFoamCode(this)">Copy</button>
                                            <pre class="foam-code">
<span class="f-key">inlet</span>
{
    <span class="f-key">type</span>            <span class="f-val">gasBurningRateInletVelocity</span>;
    <span class="f-key">rhoPropellant</span>   <span class="f-val">1500</span>; // density of the propellant
    <span class="f-key">a</span>               <span class="f-val">0.607</span>; // pre-exponential factor
    <span class="f-key">n</span>               <span class="f-val">0.798</span>; // pressure exponent
    <span class="f-key">X</span>               <span class="f-val">0.5</span>; // gas phase mass fraction
    <span class="f-key">value</span>           <span class="f-val">uniform (0 0 0)</span>;
}</pre>
                                        </div>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="bc-name">sameAs</td>
                                    <td class="bc-desc">
                                        A utility condition that copies boundary values from another specified field to the current patch. 
                                        Useful for coupling fields directly between phases.
                                    </td>
                                    <td class="bc-fields">
                                        Any Field <br>
                                    </td>
                                    <td class="bc-usage">
                                        <div class="foam-code-wrapper">
                                            <button class="bc-copy-btn" onclick="copyFoamCode(this)">Copy</button>
                                            <pre class="foam-code">
<span class="f-key">inlet</span>
{
    <span class="f-key">type</span>    <span class="f-val">sameAs</span>;
    <span class="f-key">field</span>   <span class="f-val">T.gas</span>; // field to the copied from...
    <span class="f-key">value</span>   <span class="f-val">uniform 0</span>;
}</pre>
                                        </div>
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                    
                    <p class="text-lg text-gray-700 leading-relaxed py-8">
                        In addition to the stable boundary conditions listed above, there are additional 
                        boundary conditions are currently experimental and will be included in the stable distribution in 
                        future releases.
                    </p>

                </div>
            </div>
        </section>
        
        <section id="utilities" class="bg-gray-50 border-t border-gray-200">
            <div class="container mx-auto px-6 py-12">
                <div class="max-w-5xl mx-auto"> <div class="mb-10">
                        <p class="text-2xl font-bold text-gray-900">Solver Utilities</p>
                        <p class="text-gray-600 mt-2">
                            The following utilities are included to streamline the workflow, from initialization to post-processing.
                        </p>
                    </div>
        
                    <div class="flex flex-col space-y-6">
        
                        <div class="util-card">
                            <div class="util-header">
                                <h3 class="util-title">postProcessRocket</h3>
                                <span class="util-tag">Post-processing</span>
                            </div>
                            <div class="util-body">
                                <p class="util-desc">
                                    Automatically identifies the domain outlet patch and computes the <strong>mass flow rate</strong> and <strong>thrust</strong> evolution for all available time steps.
                                </p>
                                
                                <div class="util-command-box">
                                    <div class="util-cmd-label">Usage:</div>
                                    <div class="foam-code-wrapper">
                                        <button class="bc-copy-btn" onclick="copyFoamCode(this)">Copy</button>
                                        <pre class="foam-code">$ postProcessRocket</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="util-card">
                            <div class="util-header">
                                <h3 class="util-title">setRocketInitField</h3>
                                <span class="util-tag">Pre-processing</span>
                            </div>
                            <div class="util-body">
                                <p class="util-desc">
                                    Sets the initial propellant volume fraction field based on geometric regions. 
                                    <br>
                                    <span class="text-sm text-gray-500 italic">Note: Requires a <code>setRocketInitFieldDict</code> dictionary to be present in the case directory.</span>
                                </p>
        
                                <div class="util-command-box">
                                    <div class="util-cmd-label">Usage:</div>
                                    <div class="foam-code-wrapper">
                                        <button class="bc-copy-btn" onclick="copyFoamCode(this)">Copy</button>
                                        <pre class="foam-code">$ setRocketInitField</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="util-card">
                            <div class="util-header">
                                <h3 class="util-title">mapVolFields</h3>
                                <span class="util-tag">Grid Analysis</span>
                            </div>
                            <div class="util-body">
        
                                <p class="util-desc">
                                    Maps solution fields from a fine grid (source) to the current coarse grid (target) using volume-weighted interpolation. Primarily used for <strong>grid independence studies</strong> and <strong>a posteriori error estimation</strong>.
                                    <br>
                                    <span class="text-sm text-gray-500 italic">Requirement: The fine mesh must have been generated by refining the coarse mesh using <code>refineMesh</code>.</span>
                                    <br>
                                    <strong>Note:</strong> You must execute this command from within the target case directory (the coarse mesh case).
                                </p>
                        
                                <div class="util-command-box">
                                    <div class="util-cmd-label">Usage:</div>
                                    <div class="foam-code-wrapper">
                                        <button class="bc-copy-btn" onclick="copyFoamCode(this)">Copy</button>
                                        <pre class="foam-code">$ mapVolFields &lt;sourceDir&gt; -sourceTime &lt;time&gt;</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer>
        <p class="mb-4 text-gray-500 max-w-6xl mx-auto">
            Distributed under the GNU General Public License v3 (GPL-3.0). See the 
            <a href="https://github.com/Ganeshkumar-V/Propellant-Regression-Framework/main/LICENSE" 
               target="_blank" rel="noopener noreferrer" 
               class="text-gray-500 hover:text-gray-500 hover:underline">
               LICENSE
            </a> 
            file for the full text. This software is an independent project and is neither endorsed by, nor 
            associated with OpenCFD Ltd or the OpenFOAMÂ® project. OpenFOAMÂ® is a 
            registered trademark of OpenCFD Ltd.
        </p>

        <p>
            Â© 2025 Ganeshkumar V. All rights reserved.
        </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        /* Initialize mermaid with responsive layout option */
        mermaid.initialize({ startOnLoad: true, flowchart: { useMaxWidth: true } });

        /*
         After mermaid renders the diagram(s) it inserts an <svg> with width/height attributes.
         To ensure the diagram scales when the page is zoomed, convert width/height to a viewBox
         and make the SVG responsive. We run once on DOMContentLoaded and also watch for changes
         because mermaid may render asynchronously.
        */
        document.addEventListener('DOMContentLoaded', function () {
            function makeSvgResponsive() {
                document.querySelectorAll('.mermaid svg').forEach(svg => {
                    try {
                        // If there's already a viewBox, assume it's responsive enough
                        if (!svg.getAttribute('viewBox')) {
                            const width = svg.getAttribute('width');
                            const height = svg.getAttribute('height');
                            if (width && height) {
                                svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
                                svg.removeAttribute('width');
                                svg.removeAttribute('height');
                                svg.style.width = '100%';
                                svg.style.height = 'auto';
                            }
                        }
                    } catch (e) {
                        // ignore any invalid SVGs
                    }
                });
            }

            // Initial attempt (mermaid may have already rendered)
            makeSvgResponsive();

            // Retry shortly after in case mermaid renders after DOMContentLoaded
            setTimeout(makeSvgResponsive, 500);

            // Observe DOM changes to the mermaid container and adjust newly added SVGs
            const mermaidContainers = document.querySelectorAll('.mermaid');
            mermaidContainers.forEach(container => {
                const observer = new MutationObserver(() => makeSvgResponsive());
                observer.observe(container, { childList: true, subtree: true });
            });
        });
    </script>
    
    <!-- svg-pan-zoom: enable interactive pan/zoom for rendered SVG diagrams
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <script>
        // Initialize svg-pan-zoom on every mermaid SVG once it's available
        function initPanZoomForMermaid(svg) {
            try {
                // If svg-pan-zoom instance already attached, return
                if (svg._svgPanZoom) return;

                // create an instance with reasonable defaults
                const instance = svgPanZoom(svg, {
                    zoomEnabled: true,
                    controlIconsEnabled: false,
                    fit: true,
                    center: true,
                    minZoom: 0.25,
                    maxZoom: 10,
                    dblClickZoomEnabled: true,
                    mouseWheelZoomEnabled: true
                });

                // store reference so we don't re-init
                svg._svgPanZoom = instance;

                // Adjust initial zoom so the diagram fills the container width
                function adjustInitialZoom() {
                    try {
                        instance.resize();

                        // Prefer computing scale from SVG viewBox to fill parent width
                        let vb = null;
                        try { vb = svg.viewBox && svg.viewBox.baseVal ? svg.viewBox.baseVal : null; } catch(e) { vb = null; }

                        const container = svg.parentElement || svg;
                        const containerWidth = container.clientWidth || container.getBoundingClientRect().width || 0;

                        if (vb && vb.width && containerWidth > 0) {
                            // target scale to fill width
                            const rawScale = containerWidth / vb.width;
                            const min = 0.25, max = 10;
                            const target = Math.min(max, Math.max(min, rawScale));

                            // apply target zoom and center
                            try { instance.zoom(target); } catch (e) { /* ignore */ }
                            try { instance.center(); } catch (e) { /* ignore */ }
                        } else {
                            // fallback to fit/center
                            try { instance.fit(); instance.center(); } catch (e) { /* ignore */ }
                        }
                    } catch (e) {
                        // retry once after a short delay
                        setTimeout(() => {
                            try { adjustInitialZoom(); } catch (e) {}
                        }, 120);
                    }
                }

                // run adjustment now
                adjustInitialZoom();
            } catch (e) {
                // fail silently
                console.warn('svg-pan-zoom init failed', e);
            }
        }

        // Watch for mermaid SVGs (handles async render)
        function watchMermaidSvgs() {
            document.querySelectorAll('.mermaid svg').forEach(svg => {
                // ensure viewBox exists (makes svg responsive)
                if (!svg.getAttribute('viewBox')) {
                    const w = svg.getAttribute('width');
                    const h = svg.getAttribute('height');
                    if (w && h) {
                        svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
                        svg.removeAttribute('width');
                        svg.removeAttribute('height');
                    }
                }
                initPanZoomForMermaid(svg);
            });

            // Observe for newly injected SVGs
            document.querySelectorAll('.mermaid').forEach(container => {
                if (container._mermaidObserver) return;
                const mo = new MutationObserver(() => {
                    // delay slightly to let mermaid finish writing SVG
                    setTimeout(() => watchMermaidSvgs(), 50);
                });
                mo.observe(container, { childList: true, subtree: true });
                container._mermaidObserver = mo;
            });
        }

        // Run after DOM is ready and after mermaid initializations
        document.addEventListener('DOMContentLoaded', () => {
            // small delay for mermaid to render
            setTimeout(() => watchMermaidSvgs(), 250);
            // retry once later
            setTimeout(() => watchMermaidSvgs(), 1000);
        });
    </script> -->

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoIeC+BIfme/j+Lg+Ie8HhU3SvuxfwB3kI/S6UlP8Vq+M/fG5/SPOdsLWWiMcvx" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gA9SRQAFBuPWCiR/mkIhP+E8SjO7Iib/o9dZISTQ/kQceYPLQxfM/E1fixKJi/" crossorigin="anonymous"></script>

    <script>
        renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ]
        });
    </script>
    
    <script>
        const menuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        menuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    </script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        const steps = document.querySelectorAll('.cn-step');
        const lines = document.querySelectorAll('.cn-line');
        const codeWindow = document.querySelector('.cn-code-window');
    
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // 1. Highlight the text card
                    steps.forEach(s => s.classList.remove('active'));
                    entry.target.classList.add('active');
    
                    // 2. Get lines from data attribute
                    const activeLineIds = entry.target.getAttribute('data-lines').split(',');
    
                    // 3. Reset all code lines
                    lines.forEach(l => l.classList.remove('active'));
    
                    // 4. Highlight specific lines AND Auto-Scroll
                    let firstActiveLine = null;
    
                    activeLineIds.forEach((id, index) => {
                        const el = document.getElementById(id);
                        if(el) {
                            el.classList.add('active');
                            if (index === 0) firstActiveLine = el;
                        }
                    });
    
                    // 5. The Auto-Scroll Logic
                    if (firstActiveLine && codeWindow) {
                        // Calculate position to scroll to (center the line)
                        const windowHeight = codeWindow.offsetHeight;
                        const lineTop = firstActiveLine.offsetTop;
                        const lineHeight = firstActiveLine.offsetHeight;
                        
                        // Scroll position = Line Position - Half Window Height + Half Line Height
                        const scrollTarget = lineTop - (windowHeight / 2) + (lineHeight / 2);
    
                        codeWindow.scrollTo({
                            top: scrollTarget,
                            behavior: 'smooth'
                        });
                    }
                }
            });
        }, {
            root: null,
            threshold: 0.6, // Wait until 60% of text is visible
            rootMargin: "-10% 0px -20% 0px" // Focus area in center-screen
        });
    
        steps.forEach(step => observer.observe(step));
    });

    function copyFoamCode(button) {
        // Find the pre tag immediately following the button
        const pre = button.nextElementSibling;
        const codeText = pre.innerText;
        
        // Copy to clipboard
        navigator.clipboard.writeText(codeText).then(() => {
            const originalText = button.innerText;

            // Visual feedback
            button.innerText = "Copied!";
            button.style.backgroundColor = "#28a745"; // Green
            button.style.borderColor = "#28a745";

            // Reset after 2 seconds
            setTimeout(() => {
                button.innerText = originalText;
                button.style.backgroundColor = ""; // Revert to CSS default
                button.style.borderColor = "";
            }, 2000);
        });
    }
    </script>

</body>
</html>
